<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SyncSpeaker â€” Browser Prototype</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="top">
    <div class="brand">
      <div class="logo">SS</div>
      <div>
        <div class="title">SyncSpeaker</div>
        <div class="subtitle">Browser prototype (friend test)</div>
      </div>
    </div>
    <div class="pill" id="planPill">Free Â· 2 phones</div>
  </header>

  <main class="wrap">
    <!-- Landing Page -->
    <section class="landing-page" id="viewLanding">
      <div class="landing-hero">
        <div class="dj-icon">
          <svg role="img" aria-label="DJ headphones and turntable icon" width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Headphones -->
            <path d="M40 15 C25 15, 15 25, 15 40 L15 50 C15 52, 17 54, 19 54 L25 54 C27 54, 29 52, 29 50 L29 40 C29 38, 27 36, 25 36 L21 36 C21 28, 28 21, 40 21 C52 21, 59 28, 59 36 L55 36 C53 36, 51 38, 51 40 L51 50 C51 52, 53 54, 55 54 L61 54 C63 54, 65 52, 65 50 L65 40 C65 25, 55 15, 40 15 Z" fill="url(#headphoneGradient)" stroke="url(#neonStroke)" stroke-width="2"/>
            <!-- Turntable -->
            <circle cx="40" cy="55" r="15" fill="url(#turntableGradient)" stroke="url(#neonStroke)" stroke-width="2"/>
            <circle cx="40" cy="55" r="3" fill="#5AA9FF"/>
            <defs>
              <linearGradient id="headphoneGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#5AA9FF;stop-opacity:0.6" />
                <stop offset="100%" style="stop-color:#8B7CFF;stop-opacity:0.8" />
              </linearGradient>
              <linearGradient id="turntableGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#8B7CFF;stop-opacity:0.6" />
                <stop offset="100%" style="stop-color:#5AA9FF;stop-opacity:0.8" />
              </linearGradient>
              <linearGradient id="neonStroke" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#5AA9FF" />
                <stop offset="100%" style="stop-color:#8B7CFF" />
              </linearGradient>
            </defs>
          </svg>
        </div>
        <h1 class="landing-title">SyncSpeaker</h1>
        <p class="landing-subtitle">Turn your phones into one massive speaker</p>
        
        <!-- Equalizer Bars -->
        <div class="equalizer">
          <div class="eq-bar"></div>
          <div class="eq-bar"></div>
          <div class="eq-bar"></div>
          <div class="eq-bar"></div>
          <div class="eq-bar"></div>
        </div>
      </div>

      <!-- What is SyncSpeaker -->
      <div class="glass-card">
        <h2>ğŸµ What is SyncSpeaker?</h2>
        <p>Connect multiple phones together and play music in perfect sync. Create an epic sound experience for parties, gatherings, or just hanging out with friends!</p>
        <p>Take control with DJ mode, queue your tracks, and get real-time reactions from your guests. Everything you need to be the ultimate party host.</p>
      </div>

      <!-- How it Works -->
      <div class="glass-card">
        <h2>âš¡ How it Works</h2>
        <div class="steps">
          <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>Start a Party</h3>
              <p>One person becomes the host and gets a party code</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>Friends Join</h3>
              <p>Share the code with friends to connect their phones</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>Play Together</h3>
              <p>Music plays in sync across all connected devices</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Key Features -->
      <div class="glass-card">
        <h2>âœ¨ Key Features</h2>
        <div class="features-grid">
          <div class="feature-item">
            <div class="feature-icon">ğŸ§</div>
            <h3>DJ Mode</h3>
            <p>Full-screen DJ interface with visualizers and controls. Take control with professional visual effects and real-time feedback.</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">â­ï¸</div>
            <h3>Up Next Queue</h3>
            <p>Queue your next track and see what's coming up. Seamless transitions keep the party flowing.</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">ğŸ’¬</div>
            <h3>Guest Reactions</h3>
            <p>Friends can send reactions directly to the DJ's screen. Real-time crowd feedback at your fingertips.</p>
          </div>
          <div class="feature-item">
            <div class="feature-icon">ğŸ“±</div>
            <h3>Browser-Ready</h3>
            <p>Test instantly in your browser or run with full multi-device sync. No app store required.</p>
          </div>
        </div>
      </div>

      <!-- Important Info -->
      <div class="glass-card info-card">
        <div class="info-row">
          <span class="info-icon">ğŸ“¶</span>
          <p><strong>Hotspot or Wi-Fi recommended</strong> for best connection quality</p>
        </div>
        <div class="info-row">
          <span class="info-icon">ğŸ§</span>
          <p><strong>You provide the music:</strong> This app syncs playback. Music comes from your device (Spotify, YouTube, etc.)</p>
        </div>
      </div>

      <!-- Pricing -->
      <div class="glass-card pricing-card">
        <h2>ğŸ’ Pricing</h2>
        <div class="pricing-grid pricing-grid-three">
          <div class="pricing-option">
            <div class="pricing-badge free">Free</div>
            <h3>Free Plan</h3>
            <p class="pricing-desc">Perfect for small groups</p>
            <ul class="pricing-features">
              <li>âœ“ Up to 2 phones</li>
              <li>âœ“ Basic features</li>
              <li>â€¢ Includes ads</li>
            </ul>
          </div>
          <div class="pricing-option party-pass-featured">
            <div class="popular-badge">Most popular</div>
            <div class="pricing-badge party-pass">Party Pass</div>
            <h3>ğŸ‰ Party Pass</h3>
            <p class="pricing-subtitle">(One-Night Only)</p>
            <p class="pricing-price">Â£2.99</p>
            <p class="pricing-desc">Go Pro for tonight. No commitment.</p>
            <ul class="pricing-features">
              <li>âœ“ No ads during playback</li>
              <li>âœ“ Higher phone/speaker limit</li>
              <li>âœ“ Pro DJ mode with visualizers</li>
              <li>âœ“ Guest reactions &amp; messaging</li>
              <li>âœ“ Up Next queue system</li>
              <li>âœ“ Priority sync stability</li>
              <li>âœ“ Party-wide unlock</li>
            </ul>
            <button class="btn-party-pass" id="btnActivatePartyPassLanding">Activate Party Pass</button>
            <p class="pricing-fine-print">Single-use Â· Valid for one party Â· Auto-expires after 2 hours</p>
          </div>
          <div class="pricing-option">
            <div class="pricing-badge pro">Pro</div>
            <h3>Pro Monthly</h3>
            <p class="pricing-price">Â£9.99/month</p>
            <p class="pricing-desc">Cancel anytime</p>
            <ul class="pricing-features">
              <li>âœ“ 3+ phones (up to 10)</li>
              <li>âœ“ No ads</li>
              <li>âœ“ Quality override warnings</li>
              <li>âœ“ Speaker support</li>
            </ul>
            <button class="btn-pro-monthly" id="btnSubscribeMonthly">Subscribe Monthly</button>
          </div>
        </div>
      </div>

      <!-- CTA Buttons -->
      <div class="landing-cta">
        <button class="btn-landing primary-landing" id="btnLandingStart">
          ğŸ‰ Start Party
        </button>
        <button class="btn-landing secondary-landing" id="btnLandingJoin">
          ğŸµ Join Party
        </button>
      </div>

      <!-- Background Blobs -->
      <div class="blob blob-1"></div>
      <div class="blob blob-2"></div>
      <div class="blob blob-3"></div>
    </section>

    <section class="card hidden" id="viewHome">
      <h1>Play music together</h1>
      <p class="muted">
        Prototype to test the idea + flow. Audio sync in browsers varies by device â€” focus on usability and â€œwould you use this?â€.
      </p>

      <!-- Mini Equalizer -->
      <div class="home-equalizer">
        <div class="home-eq-bar"></div>
        <div class="home-eq-bar"></div>
        <div class="home-eq-bar"></div>
        <div class="home-eq-bar"></div>
        <div class="home-eq-bar"></div>
      </div>

      <div class="grid2">
        <div class="box">
          <h3>Start a party (Host)</h3>
          <label class="lbl">Your name</label>
          <input id="hostName" class="input" value="Host" />
          
          <!-- Music from Phone Section -->
          <div class="music-section">
            <h4 class="music-section-title">ğŸµ Music (from your phone)</h4>
            <div class="music-controls">
              <input type="file" id="musicFileInput" accept="audio/*" style="display: none;" />
              <button type="button" class="btn secondary" id="btnChooseMusic">Choose music file</button>
              <button type="button" class="btn secondary hidden" id="btnChangeMusic">Change file</button>
            </div>
            <div class="music-info hidden" id="musicInfo">
              <div class="music-file-details">
                <span class="music-filename" id="musicFilename"></span>
                <span class="music-filesize" id="musicFilesize"></span>
                <span class="pill-enhanced music-status-ready" id="musicStatusReady">âœ“ Ready</span>
              </div>
            </div>
            <div class="tiny muted music-helper">
              Pick any audio file from your phone (MP3, WAV, M4A, etc). We don't provide music.
            </div>
            <div class="music-warning hidden" id="musicWarning"></div>
          </div>

          <button type="button" class="btn primary" id="btnCreate">Start party</button>
          <div class="party-status hidden" id="partyStatus">
            <div class="status-message" id="createStatusMessage">Waiting...</div>
            <div class="debug-info tiny muted" id="createDebugInfo"></div>
          </div>
          <div class="tiny muted">
            Users are responsible for music source. This app does not provide music.
          </div>
        </div>

        <div class="box">
          <h3>Join a party (Friend)</h3>
          <label class="lbl">Party code</label>
          <input id="joinCode" class="input" placeholder="ABC123" />
          <label class="lbl">Your name</label>
          <input id="guestName" class="input" value="Guest" />
          <button class="btn" id="btnJoin">Join party</button>
          <div class="party-status hidden" id="joinStatus">
            <div class="status-message" id="joinStatusMessage">Waiting...</div>
            <div class="debug-info tiny muted" id="joinDebugInfo"></div>
          </div>
          <div class="tiny muted">Tip: open this on another phone on the same Wiâ€‘Fi.</div>
        </div>
      </div>

      <div class="line"></div>

      <div class="row">
        <label class="check">
          <input type="checkbox" id="togglePro" />
          <span><b>Support mode (Pro)</b> (party-wide unlock)</span>
        </label>
        <span class="tiny muted">Testing mode: simulates Pro subscription.</span>
      </div>
    </section>

    <section class="card hidden" id="viewParty">
      <div class="row space">
        <div>
          <h2 id="partyTitle">Party</h2>
          <div class="muted tiny" id="partyMeta"></div>
        </div>
        <button class="btn danger" id="btnLeave">Leave</button>
      </div>

      <!-- OFFLINE MODE WARNING BANNER -->
      <div class="offline-warning" id="offlineWarning" style="display:none;">
        <div class="warning-icon">âš ï¸</div>
        <div class="warning-content">
          <strong>PROTOTYPE MODE - Single Device Only</strong>
          <p>Multi-device sync not available in this prototype. Party codes shown for UI testing only. For real multi-device testing, server-side implementation required.</p>
        </div>
      </div>

      <!-- Party Pass Status/Upgrade Banner -->
      <div class="party-pass-banner hidden" id="partyPassBanner">
        <div class="party-pass-status hidden" id="partyPassActive">
          <div class="party-pass-icon">ğŸ‰</div>
          <div class="party-pass-info">
            <div class="party-pass-title" id="partyPassTitle">Party Pass Active</div>
            <div class="party-pass-timer" id="partyPassTimer">5h 42m remaining</div>
            <div class="party-pass-desc hidden" id="partyPassDesc">Pro features unlocked for this party</div>
          </div>
        </div>
        <div class="party-pass-upgrade hidden" id="partyPassUpgrade">
          <div class="party-pass-upgrade-content">
            <div class="party-pass-upgrade-title">ğŸ‰ Upgrade this party â€” Â£2.99 Â· 2 hours</div>
            <p class="party-pass-upgrade-tagline">Go Pro for tonight. No commitment.</p>
            <button class="btn-party-pass" id="btnActivatePartyPass">Activate Party Pass</button>
          </div>
        </div>
      </div>

      <div class="grid3">
        <div class="box">
          <div class="row space">
            <div>
              <div class="lbl">Party code</div>
              <div class="code" id="partyCode">------</div>
            </div>
            <button class="btn" id="btnCopy">Copy</button>
          </div>
          <div class="tiny muted">Share code with friends.</div>
        </div>

        <div class="box">
          <div class="row space">
            <div>
              <div class="lbl">Connection strength</div>
              <div class="row">
                <span class="badge" id="qualityTier">Good</span>
                <span class="tiny muted" id="qualityHint">Minor drift possible</span>
              </div>
            </div>
            <div class="right tiny muted"><span id="qualityScore">80</span>/100</div>
          </div>
          <div class="bar"><div class="fill" id="qualityFill" style="width:80%"></div></div>
          <div class="tiny muted" id="limitsLine">Recommended: 4 Â· Hard cap: 8</div>
        </div>

        <div class="box">
          <div class="lbl">Playback</div>
          
          <!-- Audio Player -->
          <audio id="hostAudioPlayer" preload="auto" controls></audio>
          
          <!-- Status Area -->
          <div class="playback-status" id="playbackStatus">
            <span class="status-label">Status:</span>
            <span class="status-message" id="statusMessage">No music loaded</span>
          </div>
          
          <div class="row gap">
            <button class="btn primary" id="btnPlay">Play</button>
            <button class="btn" id="btnPause">Pause</button>
            <button class="btn" id="btnAd">Show ad (Free)</button>
          </div>
          <button class="btn secondary hidden" id="btnBackToDj">ğŸ§ Back to DJ View</button>
          <div class="tiny muted" id="adLine">Ads can pause music for free users.</div>
        </div>
      </div>

      <div class="line"></div>

      <!-- DJ Controls Card -->
      <div class="box" id="djControlsCard">
        <h3>DJ Controls</h3>
        <div class="lbl">Chat Mode</div>
        <div class="chat-mode-selector">
          <label class="chat-mode-option">
            <input type="radio" name="chatMode" value="OPEN" id="chatModeOpen" checked />
            <span class="chat-mode-label">
              <span class="chat-mode-icon">ğŸ’¬</span>
              <span class="chat-mode-text">OPEN</span>
            </span>
          </label>
          <label class="chat-mode-option">
            <input type="radio" name="chatMode" value="EMOJI_ONLY" id="chatModeEmojiOnly" />
            <span class="chat-mode-label">
              <span class="chat-mode-icon">ğŸ˜€</span>
              <span class="chat-mode-text">EMOJI ONLY</span>
            </span>
          </label>
          <label class="chat-mode-option">
            <input type="radio" name="chatMode" value="LOCKED" id="chatModeLocked" />
            <span class="chat-mode-label">
              <span class="chat-mode-icon">ğŸ”’</span>
              <span class="chat-mode-text">LOCKED</span>
            </span>
          </label>
        </div>
        <div class="tiny muted">Control guest messaging permissions</div>
      </div>

      <div class="line"></div>

      <!-- DJ Status & Monetization Section -->
      <div class="box" id="djStatusCard">
        <div class="row space">
          <div>
            <h3>DJ Status</h3>
            <div class="dj-level-info">
              <span class="dj-level-badge" id="djLevel">Level 1</span>
              <span class="dj-xp" id="djXP">0/100 XP</span>
            </div>
          </div>
          <button class="btn secondary" onclick="show('modalProUpgrade')">Upgrade to Pro</button>
        </div>
        <div class="tiny muted">Earn XP by hosting parties and engaging guests</div>
      </div>

      <div class="line"></div>

      <!-- Monetization Quick Actions -->
      <div class="box" id="monetizationActionsCard">
        <h3>Party Enhancements</h3>
        <div class="monetization-actions">
          <button class="btn secondary" onclick="show('modalHostGiftedPass')" id="btnHostGiftedPass">
            ğŸ‰ Unlock for Everyone
          </button>
          <button class="btn secondary" onclick="show('modalDJPacks'); updateDJPacksUI()">
            ğŸ¨ DJ Packs
          </button>
          <button class="btn secondary" onclick="captureHighlight()">
            ğŸ“¸ Capture Highlight
          </button>
          <button class="btn secondary" onclick="show('modalPartyMemories')">
            ğŸ’¾ Party Memories
          </button>
        </div>
        <div class="tiny muted">Enhance your party experience</div>
      </div>

      <!-- Active Micro-Unlocks Display -->
      <div class="box hidden" id="activeMicroUnlocksCard">
        <h3>Active Effects</h3>
        <div id="activeMicroUnlocks" class="micro-unlocks-container"></div>
      </div>

      <!-- Guest Boosts (Host View) -->
      <div class="box hidden" id="guestBoostsCard">
        <h3>ğŸ Guest Gifts</h3>
        <div id="guestBoostsContainer" class="guest-boosts-list"></div>
      </div>

      <div class="line"></div>

      <div class="row space">
        <h3>Friends connected</h3>
        <div class="row gap">
          <button class="btn" id="btnAddPhone">Add another phone</button>
          <button class="btn" id="btnSpeaker">Use a speaker</button>
        </div>
      </div>

      <div id="members"></div>

      <div class="tiny muted" style="margin-top:10px">
        Browser prototype â€” next step is the real Android app for proper sync.
      </div>
    </section>

    <!-- DJ Screen Overlay (Host Only - Shows when playing) -->
    <div class="dj-screen-overlay hidden" id="djScreenOverlay">
      <div class="dj-screen-header">
        <div class="dj-screen-title">
          <span class="dj-icon-small">ğŸ§</span>
          <span>DJ MODE</span>
        </div>
        <button class="btn-close-dj" id="btnCloseDj">âœ• Close DJ View</button>
      </div>

      <!-- DJ Main Visual Area -->
      <div class="dj-main-visual">
        <div class="dj-equalizer-large" id="djEqualizerLarge">
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
          <div class="dj-eq-bar"></div>
        </div>
        
        <!-- Now Playing Display -->
        <div class="dj-now-playing">
          <div class="dj-now-playing-label">NOW PLAYING</div>
          <div class="dj-now-playing-track" id="djNowPlayingTrack">No Track</div>
        </div>
        
        <!-- Up Next Display -->
        <div class="dj-up-next hidden" id="djUpNext">
          <div class="dj-up-next-label">â­ UP NEXT</div>
          <div class="dj-up-next-track" id="djUpNextTrack">No track queued</div>
        </div>
      </div>

      <!-- Guest Messages Area -->
      <div class="dj-messages-area">
        <div class="dj-messages-header">
          <span class="dj-messages-icon">ğŸ’¬</span>
          <span>GUEST REACTIONS</span>
        </div>
        <div class="dj-messages-container" id="djMessagesContainer">
          <div class="dj-no-messages" id="djNoMessages">
            Waiting for guest reactions...
          </div>
        </div>
      </div>

      <!-- DJ Controls -->
      <div class="dj-controls">
        <button class="btn-dj-control" id="btnDjPlay">
          <span class="dj-control-icon">â–¶ï¸</span>
          <span>PLAY</span>
        </button>
        <button class="btn-dj-control" id="btnDjPause">
          <span class="dj-control-icon">â¸ï¸</span>
          <span>PAUSE</span>
        </button>
        <button class="btn-dj-control secondary" id="btnDjNext">
          <span class="dj-control-icon">â­ï¸</span>
          <span>NEXT</span>
        </button>
      </div>

      <!-- Queue Next Track -->
      <div class="dj-queue-section">
        <input type="file" id="djQueueFileInput" accept="audio/*" style="display: none;" />
        <button class="btn-dj-queue" id="btnDjQueueTrack">
          <span class="dj-queue-icon">ğŸ“</span>
          <span>QUEUE NEXT TRACK</span>
        </button>
      </div>

      <!-- Peak Moment Buttons -->
      <div class="dj-peak-moments">
        <div class="dj-peak-label">PEAK MOMENTS</div>
        <div class="dj-peak-buttons">
          <button class="btn-peak-moment" onclick="showMicroUnlockModal('ultra_drop')">
            âš¡ Ultra Drop
          </button>
          <button class="btn-peak-moment" onclick="showMicroUnlockModal('festival_lights')">
            ğŸ’¡ Festival Lights
          </button>
          <button class="btn-peak-moment" onclick="showMicroUnlockModal('crowd_takeover')">
            ğŸ™Œ Crowd Takeover
          </button>
        </div>
      </div>

      <!-- Party Info -->
      <div class="dj-party-info">
        <div class="dj-party-code">
          <span class="dj-info-label">PARTY CODE:</span>
          <span class="dj-info-value" id="djPartyCode">------</span>
        </div>
        <div class="dj-party-guests">
          <span class="dj-info-label">GUESTS:</span>
          <span class="dj-info-value" id="djGuestCount">0</span>
        </div>
      </div>

      <!-- Flash Overlay for Messages -->
      <div class="dj-flash-overlay" id="djFlashOverlay"></div>
    </div>

    <!-- Guest Party View -->
    <section class="card hidden" id="viewGuest">
      <div class="row space">
        <div>
          <h2>ğŸµ Guest Party</h2>
          <div class="muted tiny" id="guestMeta">Connected to party</div>
        </div>
        <button class="btn danger" id="btnGuestLeave">Leave Party</button>
      </div>

      <!-- Party Code and Connection Status -->
      <div class="guest-header">
        <div class="glass-card">
          <div class="row space">
            <div>
              <div class="lbl">Party Code</div>
              <div class="code" id="guestPartyCode">------</div>
            </div>
            <div class="guest-connection-status">
              <div class="lbl">Status</div>
              <span class="badge" id="guestConnectionStatus">Connecting...</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Party Status Badge -->
      <div class="guest-party-status">
        <div class="party-status-badge" id="guestPartyStatusBadge">
          <span class="party-status-icon">âœ¨</span>
          <span class="party-status-text" id="guestPartyStatusText">Free Plan</span>
          <span class="party-status-timer hidden" id="guestPartyPassTimer"></span>
        </div>
      </div>

      <!-- Now Playing Section -->
      <div class="glass-card guest-now-playing">
        <h3 class="section-title">ğŸµ Now Playing</h3>
        <div class="now-playing-content">
          <div class="track-info">
            <div class="track-filename" id="guestNowPlayingFilename">No track selected</div>
            <div class="playback-state-badge">
              <span class="playback-state-icon" id="guestPlaybackStateIcon">â¸</span>
              <span class="playback-state-text" id="guestPlaybackStateText">Waiting</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Up Next Section -->
      <div class="glass-card guest-up-next hidden" id="guestUpNextSection">
        <h4 class="section-title-small">â­ Up Next</h4>
        <div class="up-next-content">
          <div class="up-next-filename" id="guestUpNextFilename">No track queued</div>
          <span class="up-next-status-badge">Ready</span>
        </div>
      </div>

      <!-- DJ Visuals Area -->
      <div class="glass-card guest-dj-visuals">
        <h3 class="section-title">ğŸ§ DJ Visuals</h3>
        <div class="dj-visual-container" id="guestDjVisuals">
          <div class="equalizer guest-equalizer" id="guestEqualizer">
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
            <div class="eq-bar"></div>
          </div>
          <div class="visual-status-text" id="guestVisualStatus">Synced visuals (prototype)</div>
        </div>
      </div>

      <!-- Guest Volume Control -->
      <div class="glass-card guest-volume">
        <h4 class="section-title-small">ğŸ”Š Your Volume (Local)</h4>
        <div class="volume-control">
          <input type="range" min="0" max="100" value="80" class="volume-slider" id="guestVolumeSlider" />
          <span class="volume-value" id="guestVolumeValue">80%</span>
        </div>
        <div class="tiny muted">Adjust volume on your device only</div>
      </div>

      <!-- Guest Messages to Host -->
      <div class="glass-card guest-messages">
        <div class="guest-messages-header">
          <h4 class="section-title-small">ğŸ’¬ Send Message to DJ</h4>
          <div class="guest-chat-mode-badge" id="guestChatModeBadge">
            <span class="chat-mode-status-icon" id="guestChatModeIcon">ğŸ’¬</span>
            <span class="chat-mode-status-text" id="guestChatModeText">Chat: OPEN</span>
          </div>
        </div>
        
        <!-- Emoji Reactions (always visible) -->
        <div class="guest-emoji-reactions" id="guestEmojiReactions">
          <button class="btn-emoji-reaction" id="btnEmojiHeart" data-emoji="â¤ï¸" data-message="â¤ï¸">
            â¤ï¸
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiLove" data-emoji="ğŸ˜" data-message="ğŸ˜">
            ğŸ˜
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiFire" data-emoji="ğŸ”¥" data-message="ğŸ”¥">
            ğŸ”¥
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiParty" data-emoji="ğŸ‰" data-message="ğŸ‰">
            ğŸ‰
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiDance" data-emoji="ğŸ’ƒ" data-message="ğŸ’ƒ">
            ğŸ’ƒ
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiThumbsUp" data-emoji="ğŸ‘" data-message="ğŸ‘">
            ğŸ‘
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiStar" data-emoji="â­" data-message="â­">
            â­
          </button>
          <button class="btn-emoji-reaction" id="btnEmojiLightning" data-emoji="âš¡" data-message="âš¡">
            âš¡
          </button>
        </div>
        
        <!-- Text Messages (shown when not emoji-only or locked) -->
        <div class="guest-message-buttons" id="guestTextMessages">
          <button class="btn-guest-message" id="btnMessageTune" data-message="TUUUUNE!!!">
            ğŸ”¥ TUUUUNE!!!
          </button>
          <button class="btn-guest-message" id="btnMessageTuneUp" data-message="Tune it up!!">
            ğŸšï¸ Tune it up!!
          </button>
          <button class="btn-guest-message" id="btnMessageNext" data-message="Next!">
            â­ï¸ Next!
          </button>
        </div>
        <div class="tiny muted">Send reactions to the host's DJ screen</div>
      </div>

      <!-- Guest Boost Button -->
      <div class="glass-card guest-boost-section">
        <button class="btn secondary" onclick="show('modalGuestBoost')" style="width: 100%;">
          ğŸ Gift a Boost to Host
        </button>
        <div class="tiny muted" style="text-align: center; margin-top: 8px;">
          Send premium features to enhance the party
        </div>
      </div>

      <div class="tiny muted" style="margin-top:20px; text-align: center;">
        Playback controlled by host Â· Browser prototype
      </div>
    </section>
  
<!-- Debug Panel (Prototype Only) -->
<div class="debug-panel" id="debugPanel" aria-hidden="true">
  <h4 class="debug-title">Debug Panel (Prototype)</h4>
  <div class="debug-row">
    <span class="debug-label">Role:</span>
    <span class="debug-value" id="debugRole">None</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Party Code:</span>
    <span class="debug-value" id="debugPartyCode">None</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Connected:</span>
    <span class="debug-value" id="debugConnected">false</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Now Playing:</span>
    <span class="debug-value" id="debugNowPlaying">None</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Up Next:</span>
    <span class="debug-value" id="debugUpNext">None</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Playback State:</span>
    <span class="debug-value" id="debugPlaybackState">STOPPED</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Last Host Event:</span>
    <span class="debug-value" id="debugLastHostEvent">None</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Visual Mode:</span>
    <span class="debug-value" id="debugVisualMode">idle</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Last endpoint:</span>
    <span class="debug-value" id="debugEndpoint">None</span>
  </div>
  <div class="debug-row">
    <span class="debug-label">Last error:</span>
    <span class="debug-value" id="debugError">None</span>
  </div>
</div>

<!-- Promo Code -->
<button class="btn secondary" id="promoBtn">Have a promo code?</button>

<div class="modal hidden" id="promoModal">
  <div class="modal-card">
    <h3>Enter promo code</h3>
    <input id="promoInput" placeholder="Promo code" />
    <button class="btn primary" id="promoApply">Unlock this party</button>
    <p class="hint">Promo codes unlock Pro for one party only.</p>
    <button class="btn link" id="promoClose">Cancel</button>
  </div>
</div>

</main>

  <div class="modal hidden" id="modalPaywall">
    <div class="modalCard">
      <h3>Support SyncSpeaker</h3>
      <p class="muted">Support removes ads, allows 3+ phones, and lets you add more phones when you choose.</p>
      <ul class="list">
        <li>No ads</li>
        <li>3+ phones</li>
        <li>Connection strength override warning + accept</li>
        <li>Speaker support</li>
      </ul>
      <div class="row gap">
        <button class="btn primary" id="btnProYes">Support mode (Pro)</button>
        <button class="btn" id="btnProNo">Not now</button>
      </div>
      <div class="tiny muted">Subscription only. Cancel anytime.</div>
    </div>
  </div>

  <div class="modal hidden" id="modalWarn">
    <div class="modalCard">
      <h3>Heads up</h3>
      <p class="muted" id="warnText"></p>
      <div class="row gap">
        <button class="btn" id="btnWarnCancel">Cancel</button>
        <button class="btn primary" id="btnWarnAnyway">Add anyway</button>
      </div>
      <div class="tiny muted">This option is for supporters.</div>
    </div>
  </div>

  <div class="modal hidden" id="modalSpeaker">
    <div class="modalCard">
      <h3>Connect to a speaker</h3>
      <p class="muted">
        Connect a Bluetooth or AUX speaker to the host phone for louder sound. (Real app will handle delay better.)
      </p>
      <div class="row gap">
        <button class="btn primary" id="btnSpeakerOk">Got it</button>
      </div>
      <div class="tiny muted">Speaker support is for supporters.</div>
    </div>
  </div>

  <!-- Host-Gifted Party Pass Modal -->
  <div class="modal hidden" id="modalHostGiftedPass">
    <div class="modalCard">
      <h3>ğŸ‰ Unlock this party for everyone</h3>
      <p class="muted">One payment. Everyone unlocked.</p>
      <ul class="list">
        <li>Ad-free party for all guests</li>
        <li>Preset shoutouts</li>
        <li>Full emoji reactions</li>
        <li>Hype visuals</li>
        <li>Extended phone limit</li>
      </ul>
      <p class="highlight">Party Pass lasts 2 hours</p>
      <div class="row gap">
        <button class="btn primary" onclick="activateHostGiftedPass()">Unlock Â£4.99</button>
        <button class="btn" onclick="hide('modalHostGiftedPass')">Not now</button>
      </div>
      <div class="tiny muted">No account required (simulated)</div>
    </div>
  </div>

  <!-- Party Extension Modal -->
  <div class="modal hidden" id="modalExtendParty">
    <div class="modalCard">
      <h3>â° Party ending soon</h3>
      <p class="muted">Your Party Pass expires in less than 10 minutes.</p>
      <p class="highlight">Extend 1 hour for Â£1.99</p>
      <div class="row gap">
        <button class="btn primary" onclick="extendParty()">Extend Party</button>
        <button class="btn" onclick="hide('modalExtendParty')">Let it end</button>
      </div>
      <div class="tiny muted">Keep the party going without interruption</div>
    </div>
  </div>

  <!-- DJ Packs Selection Modal -->
  <div class="modal hidden" id="modalDJPacks">
    <div class="modalCard">
      <h3>ğŸ¨ DJ Packs</h3>
      <p class="muted">Customize your party visuals with exclusive DJ packs</p>
      <div id="djPacksContainer" class="dj-packs-grid"></div>
      <button class="btn link" onclick="hide('modalDJPacks')">Close</button>
      <div class="tiny muted">Pro users get all packs included</div>
    </div>
  </div>

  <!-- Buy DJ Pack Modal -->
  <div class="modal hidden" id="modalBuyPack">
    <div class="modalCard">
      <h3>Purchase DJ Pack</h3>
      <p class="muted" id="buyPackDesc"></p>
      <div class="row gap">
        <button class="btn primary" id="btnBuyPack">Buy Now</button>
        <button class="btn" onclick="hide('modalBuyPack')">Cancel</button>
      </div>
      <div class="tiny muted">One-time purchase. Yours forever.</div>
    </div>
  </div>

  <!-- Micro-Unlock Modal -->
  <div class="modal hidden" id="modalMicroUnlock">
    <div class="modalCard">
      <h3 id="microUnlockTitle">Peak Moment</h3>
      <p class="muted" id="microUnlockDesc"></p>
      <div class="row gap">
        <button class="btn primary" id="btnMicroUnlock">Activate Â£0.99</button>
        <button class="btn" onclick="hide('modalMicroUnlock')">Not now</button>
      </div>
      <div class="tiny muted">Temporary boost. Auto-expires.</div>
    </div>
  </div>

  <!-- Guest Boost Modal -->
  <div class="modal hidden" id="modalGuestBoost">
    <div class="modalCard">
      <h3>ğŸ Gift to Host</h3>
      <p class="muted">Send a boost to enhance the party</p>
      <div class="boost-options">
        <button class="btn boost-option" onclick="sendGuestBoost('better_visuals')">
          <div class="boost-name">Better Visuals</div>
          <div class="boost-price">Â£0.99</div>
        </button>
        <button class="btn boost-option" onclick="sendGuestBoost('extend_30min')">
          <div class="boost-name">Extend 30 mins</div>
          <div class="boost-price">Â£0.99</div>
        </button>
        <button class="btn boost-option" onclick="sendGuestBoost('unlock_shoutouts')">
          <div class="boost-name">Unlock Shoutouts</div>
          <div class="boost-price">Â£1.49</div>
        </button>
      </div>
      <button class="btn link" onclick="hide('modalGuestBoost')">Cancel</button>
      <div class="tiny muted">Host must approve your gift</div>
    </div>
  </div>

  <!-- Party Memories Modal -->
  <div class="modal hidden" id="modalPartyMemories">
    <div class="modalCard">
      <h3>ğŸ“¸ Party Memories</h3>
      <p class="muted">Unlock downloadable party highlights and stats</p>
      <div id="highlightsContainer" class="muted tiny">No highlights yet</div>
      <ul class="list">
        <li>All captured highlights</li>
        <li>Guest list and timestamps</li>
        <li>Track history</li>
        <li>Downloadable recap video</li>
      </ul>
      <div class="row gap">
        <button class="btn primary" onclick="unlockPartyMemories()">Unlock Â£2.99</button>
        <button class="btn" onclick="hide('modalPartyMemories')">Not now</button>
      </div>
      <div class="tiny muted">Available immediately after party ends</div>
    </div>
  </div>

  <!-- Limited-Time Offer Modal -->
  <div class="modal hidden" id="modalLimitedOffer">
    <div class="modalCard">
      <h3>âš¡ Limited-Time Offer</h3>
      <p class="muted" id="offerName">Special Deal</p>
      <div class="offer-price" id="offerPrice">Â£9.99</div>
      <div class="offer-timer" id="offerTimer">10:00</div>
      <div class="row gap">
        <button class="btn primary" onclick="acceptLimitedOffer()">Claim Offer</button>
        <button class="btn" onclick="hide('modalLimitedOffer')">Pass</button>
      </div>
      <div class="tiny muted">This offer won't come back</div>
    </div>
  </div>

  <!-- Pro Features Upgrade Modal -->
  <div class="modal hidden" id="modalProUpgrade">
    <div class="modalCard">
      <h3>ğŸ’ Unlock Pro DJ Mode</h3>
      <p class="highlight">Â£9.99/month</p>
      <ul class="list">
        <li>âœ¨ Unlimited parties</li>
        <li>ğŸ¯ DJ Moment buttons</li>
        <li>ğŸ’¬ Chat modes (Open / Emoji / Locked)</li>
        <li>âš¡ Crowd Energy meter</li>
        <li>ğŸ“Š Party recap stats</li>
        <li>ğŸ¨ Beat-aware visuals</li>
        <li>ğŸŒˆ Theme selection</li>
        <li>ğŸ“ Typed guest messages (approval)</li>
        <li>ğŸ All DJ Packs included</li>
        <li>â­ Priority visuals</li>
      </ul>
      <div class="row gap">
        <button class="btn primary" onclick="upgradeToPro()">Subscribe Â£9.99/mo</button>
        <button class="btn" onclick="hide('modalProUpgrade')">Maybe later</button>
      </div>
      <div class="tiny muted">Cancel anytime. No commitment.</div>
    </div>
  </div>

  <div class="toast hidden" id="toast"></div>

  <script src="app.js"></script>
</body>
</html>
